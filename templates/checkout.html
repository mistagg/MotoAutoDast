{% extends 'base.html' %}
{% load cart_extras %}

{% block content %}
<main>
    <section class="py-5" style="background-color: #f5f5f5;">
        <div class="container">
            <h2 class="text-center mb-4 fw-bold">Resumen de Compra</h2>

            <form method="POST" action="{% url 'iniciar_pago' %}">
                {% csrf_token %}

                <div class="card shadow-sm mb-4">
                    <div class="card-body">

                        <h5 class="mb-4">Detalles de tu compra:</h5>

                        {% if carrito %}
                            <ul class="list-group mb-4">
                                {% for key, item in carrito.items %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span>
                                            <strong>{{ item.nombre }}</strong>
                                            - ${{ item.precio|floatformat:2 }} x {{ item.cantidad }}
                                        </span>
                                        <span class="fw-bold">${{ item.precio|mul:item.cantidad }}</span>
                                    </li>
                                {% endfor %}
                            </ul>

                            <p class="fs-5 fw-bold">Total: ${{ total }}</p>

                            <hr>

                            <!-- üî• Opciones de entrega -->
                            <h5 class="fw-bold mt-3">M√©todo de entrega</h5>

                            <div class="form-check mt-2">
                                <input class="form-check-input" type="radio" name="envio_opcion"
                                       id="retiro" value="retiro" checked>
                                <label class="form-check-label" for="retiro">
                                    Retiro en tienda
                                </label>
                            </div>

                            <div class="form-check mt-2">
                                <input class="form-check-input" type="radio" name="envio_opcion"
                                       id="envio" value="envio">
                                <label class="form-check-label" for="envio">
                                    Env√≠o a domicilio
                                </label>
                            </div>

                            <!-- üî• Formulario de direcci√≥n (solo si selecciona env√≠o) -->
                            <div id="direccion_container" class="mt-3" style="display:none;">
                                <label class="fw-bold">Direcci√≥n de entrega:</label>
                                <input type="text" name="direccion_envio" class="form-control"
                                       placeholder="Ingresa tu direcci√≥n completa">
                            </div>

                            <div class="text-end mt-4">
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="bi bi-credit-card"></i> Proceder al Pago
                                </button>
                            </div>

                        {% else %}
                            <p class="text-center fs-5 text-muted">Tu carrito est√° vac√≠o.</p>
                            <div class="text-center mt-3">
                                <a href="{% url 'lista_productos' %}" class="btn btn-outline-primary">
                                    <i class="bi bi-arrow-left"></i> Volver a la tienda
                                </a>
                            </div>
                        {% endif %}

                    </div>
                </div>
            </form>
        </div>
    </section>
</main>

<script>

document.querySelectorAll('input[name="envio_opcion"]').forEach(radio => {
    radio.addEventListener("change", function () {
        document.getElementById("direccion_container").style.display =
            (this.value === "envio") ? "block" : "none";
    });
});
</script>

{% endblock %}